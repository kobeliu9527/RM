@page "/DesiginerPro"
@layout Designer
<div class="dmain-left" style="background-color:rebeccapurple">
    l
</div>

<div class="dmain-main" style="z-index:1">
    @if (Controlmain!=null)
    {
        <CascadingValue Value="this" Name="DesiginerPro" IsFixed="true">
            <ControlComponent Data="Controlmain" ParentData="Controlmain"></ControlComponent>
        </CascadingValue>
    }


</div>
<div class="dmain-right" style="background-color:aqua">
    @if (SelectControl != null)
    {
        <EditorForm Model="@SelectControl">
            <FieldItems>
                    <EditorItem @bind-Field="@context.Name"/>
                    <EditorItem @bind-Field="@context.Height" />
                <EditorItem @bind-Field="@context.Basis" />
                <EditorItem @bind-Field="@context.Zindex" />
            </FieldItems>
            <Buttons>
                <Button OnClick="StateHasChangedInvoke">刷新</Button>
            </Buttons>
        </EditorForm>
    }
</div>
@code {
    public Control Controlmain { get; set; } = new() { Name = "主页面", CtrType = WidgetType.None ,Zindex=11};

    public Control? SelectControl { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        return;
        var Control = new Control(WidgetType.Split, 1) { Height = 60 };
        var row = new Control(WidgetType.Row) { };
        row.Controls.Add(new Control());
        row.Controls.Add(new Control(WidgetType.InputText) { Zindex = 11 });
        var sp = new Control(WidgetType.Split, 2) { IsVertical = true };
        sp.Controls[0].Controls.Add(row);
        Control.Controls[0].Controls.Add(new Control() { Zindex = 2 });
        Control.Controls[0].Controls.Add(new Control() { Zindex = 2 });
        Control.Controls[0].Controls.Add(new Control() { Zindex = 2 });
        Control.Controls[1].Controls.Add(sp);
        Controlmain.Controls.Add(Control);
        var json=   System.Text.Json.JsonSerializer.Serialize(Controlmain);
        Controlmain = System.Text.Json.JsonSerializer.Deserialize<Control>(json)??new Control();
    }

    
    public void StateHasChangedInvoke()
    {
        StateHasChanged();
    }
}
